# VATSIM SWIM API - Apache Configuration
# Ensures Authorization header is passed to PHP and enables CORS

# Pass Authorization header to PHP (required for Bearer token auth)
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Pass Authorization header through to PHP
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</IfModule>

# Alternative: CGI PassAuth (for CGI/FastCGI setups)
<IfModule mod_cgi.c>
    CGIPassAuth On
</IfModule>

# SetEnvIf for Authorization header
<IfModule mod_setenvif.c>
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
</IfModule>

# CORS Headers for API access
<IfModule mod_headers.c>
    # Allow cross-origin requests
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Authorization, Content-Type, X-SWIM-Source, X-API-Key"
    Header always set Access-Control-Max-Age "86400"

    # Handle OPTIONS preflight requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=204,L]
</IfModule>
